<!DOCTYPE html><html lang="en"><head><link href="/apple-icon-57x57.png" rel="apple-touch-icon" sizes="57x57"><link href="/apple-icon-60x60.png" rel="apple-touch-icon" sizes="60x60"><link href="/apple-icon-72x72.png" rel="apple-touch-icon" sizes="72x72"><link href="/apple-icon-76x76.png" rel="apple-touch-icon" sizes="76x76"><link href="/apple-icon-114x114.png" rel="apple-touch-icon" sizes="114x114"><link href="/apple-icon-120x120.png" rel="apple-touch-icon" sizes="120x120"><link href="/apple-icon-144x144.png" rel="apple-touch-icon" sizes="144x144"><link href="/apple-icon-152x152.png" rel="apple-touch-icon" sizes="152x152"><link href="/apple-icon-180x180.png" rel="apple-touch-icon" sizes="180x180"><link href="/android-icon-192x192.png" rel="icon" sizes="192x192" type="image/png"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/manifest.json" rel="manifest"><meta content="#ffffff" name="msapplication-TileColor"><meta content="/ms-icon-144x144.png" name="msapplication-TileImage"><meta content="#ffffff" name="theme-color"><meta charset="utf-8"><meta content="width=device-width, initial-scale=1" name="viewport"><title>i dunno what i am doing — Software Engineering Blog</title><meta content="A software engineering blog." name="description"><link rel="stylesheet" media=all href="/css/theme-2tsizFQMEPpoeD3aZvjzXw==.css" />
</head><body class="min-h-screen bg-black text-c64ink antialiased font-mono"><div class="mx-auto max-w-prose px-4 sm:px-6 lg:px-8"><main class="py-10 space-y-16" id="content"><header class="pt-10 pb-6 border-b border-c64alt/30"><div class="flex items-center justify-between gap-4"><a class="group inline-flex items-center gap-3" href="#"><h1 class="text-2xl tracking-wide">i dunno what i am doing</h1><span class="block"></span></a></div><p class="mt-3 text-sm opacity-80"><em>Software engineering à la Mexicana</em><div class="text-xs"><p>This is a very opinionated blog about software engineering. None of the following is<em> la neta del planeta.</em> If you came here for tru tru, nah, move along. What we do he'a is throw ideas 'round and see what kind of desmadre they cause. It's messy, questionable, ilogical, and maybe illegal. Don't use these ideas, play with them, learn with them, steal what you find useful, and move on, carnal.</p></div></p></header><details class="max-w-xl mx-auto mt-6"><summary class="cursor-pointer select-none text-white p-3 rounded flex items-center justify-between"><span>World of Noumenon [2025.12.01](WIP)</span><span>[+]</span></summary></details><details class="max-w-xl mx-auto mt-6"><summary class="cursor-pointer select-none text-white p-3 rounded flex items-center justify-between"><span>Database [2025.10.29](WIP)</span><span>[+]</span></summary></details><details class="max-w-xl mx-auto mt-2"><summary class="cursor-pointer select-none text-white p-3 rounded flex items-center justify-between"><span>A Simple Redis [2025.10.10](WIP)</span><span>[+]</span></summary></details><details class="max-w-xl mx-auto mt-2"><summary class="cursor-pointer select-none text-white p-3 rounded flex items-center justify-between"><span>How I Matched Invoices [2025.09.17](WIP)</span><span>[+]</span></summary><article class="max-w-none text-sm"><p class="mt-6">Matching financial records can be deceptively tricky. In this post, we'll walk through a small, orthogonal design that lets you compose simple rules into a robust system.</p><h4 class="mt-6 font-semibold tracking-tight">[•] The Situation</h4><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">You have two lists. On one side, reconciliation_items (a.k.a. the poor souls from your bank statements). On the other side, invoices (a.k.a. the proud warriors of your accounting system). Your job? Match them together. And no, you can't just eyeball them while sipping cafe con leche. You need something systematic, repeatable, and fun.</p><p class="text-base text-neutral-700 dark:text-neutral-300">We can hack a spaghetti if-else conditionals until the compiler shits bricks. But we can do better. Much better. We can do it orthogonal ISA style.</p><p class="text-base text-neutral-700 dark:text-neutral-300">OK, there are a million ways to do this (exactly 1,456,778.42 ways), but it's my engineering blog, so I'll do it my way, you're not my mom.</p><p class="text-base text-neutral-700 dark:text-neutral-300">Fair warning: I'm obsessed with orthogonal instruction-set architecture. Why? Dunno. My brain just, well, goes bananas.</p><h3 class="mt-6 font-semibold tracking-tight">[•] Orthogonal ISA</h3><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">ISA = Instruction Set Architecture. Think of your CPU: it has a set of small, atomic instructions<em> (add, load, jump, etc.).</em> Orthogonal means these instructions are independent and composable. You don't have one giant monster instruction called<em> add_two_numbers_if_they_are_positive_and_etc.</em></p><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">Instead, you have:<ul class="ml-6 mt-6"><li><b>• Require:</b> "This must be true, or bye-bye match."</li><li><b>• Compare:</b> "Measure similarity and add some points."</li><li><b>• Weight:</b> "Scale the score because why not."</li><li><b>• Flag:</b> "Mark a condition in context, like ‘oye, this vendor looks sus’."</li><li><b>• If:</b> "Branch to a tiny program if some condition is met."</li></ul></p><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">It’s like LEGO, but for cookin' the numbers,<em> *cough*</em>, accounting, I mean.</p><h3 class="mt-6 font-semibold tracking-tight">[•] Accounting</h3><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">Reconciling invoices is usually:<ol class="mt-6 ml-6"><li>• Amounts must match (más o menos).</li><li>• Currencies must match (obvio).</li><li>• Dates must be close (7 days? 10? depende de tu jefe).</li><li>• Names must look similar enough (thank you, Jaro-Winkler, our hero).</li></ol></p><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">This screams for an instruction set. Each rule is an instruction, and a match is just running a program over a pair.</p><h3 class="mt-6 font-semibold tracking-tight">[•] Solution</h3><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">We build a tiny VM in Elixir:<ol class="ml-6 mt-6"><li><b>ReconciliationMatcher.State</b> holds the left (reco item), right (invoice), current score, context, and logs.</li><li><b>ReconciliationMatcher.Instruction</b> defines Require, Compare, Weight, Flag, If.</li><li><b>ReconciliationMatcher.Metrics</b> is where we keep similarity functions: exact eq, within_days, within_pct, Jaro, etc.</li><li><b>ReconciliationMatcher.VM</b> runs a program (list of instructions) on a pair.</li><li><b>ReconciliationMatcher.Engine</b> matches two lists and applies tie-breakers.</li><li><b>ReconciliationMatcher.DSL</b> makes writing rules human-friendly.</li></ol></p><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">A rule program looks like this:</p><div class="mt-6"><script src="https://gist.github.com/n0um3n4/cd02b776f8571dbf9c6cde2af93b70b1.js"></script></div><p class="mt-6 text-base text-neutral-700 dark:text-neutral-300">Now, to run:</p><div class="mt-6"><script src="https://gist.github.com/n0um3n4/e64db223356efa0bc7e357ed3b9ba9fd.js"></script></div><p class="text-base text-neutral-700 dark:text-neutral-300">This prints out matches, their scores, and a log of why they matched. Transparencia, baby.</p><h3 class="mt-6 font-semibold tracking-tight">[•] ReconciliationMatcher.State</h3><div class="mt-6"><script src="https://gist.github.com/n0um3n4/05a2bc9f61ac38c1e9df89d4bf4bc1e4.js"></script></div><p class="text-base text-neutral-700 dark:text-neutral-300">The module is basically the state struct that your tiny matching "virtual machine" carries around while it executes instructions for a<em> {reconciliation_item, invoice}</em> pair.</p><h3 class="mt-6 font-semibold tracking-tight">[••] Definitions</h3><p class="text-base text-neutral-700 dark:text-neutral-300"><ul clas="ml-6 mt-6"><li><b>:left</b><em> This holds the reconciliation_item you’re currently evaluating. (Think: "bank side" record).</em></li><li class="mt-6"><b>:right</b><em> This holds the invoice you’re comparing against. (Think: "accounting side" record).</em></li><li class="mt-6"><b>:context</b><em> A map where instructions can store flags, intermediate values, or metadata. Example: a Flag instruction could mark %{sus_vendor: true} if it detects something odd. This makes the VM flexible: you can condition later instructions on these values.</em></li><li class="mt-6"><b>:score</b><em> The accumulated numeric score for how well the two records match. Starts at 0.0 and grows as Compare instructions succeed. Example: an amount similarity might add +0.7, a name similarity +0.3, giving you 1.0.</em></li><li class="mt-6"><b>:hard_fail?</b><em> A boolean that says: “This pair should never match.” If a Require instruction fails (like different currencies), this flips to true and stops further meaningful accumulation. That way you don’t accidentally accept garbage matches.</em></li><li class="mt-6"><b>:log</b><em> A list of strings that track what happened during execution. Every instruction appends a note here (e.g. "CMP amount ±1.5%: sim = 0.98 * w = 0.7 -> +0.686"). This makes it easy to explain matches later to humans (“oye jefe, mira the log!”).</em></li><li class="mt-6"><b>function :log</b><em> Small helper to append a message to the log. It just prepends a new string (msg) to the list.</em></li></ul></p><h3 class="mt-6 font-semibold tracking-tight">[to be continued...]</h3></article></details><footer class="py-10 mt-12 border-t border-c64alt/30 text-xs opacity-80"><div><p style="text-align: center;"><a href="https://idunnowhatiamdoing.engineering"><b>i dunno what i am doing</b></a> by<a href="https://github.com/n0um3n4"><b> noumena</b></a> is marked<a href="https://creativecommons.org/publicdomain/zero/1.0/"><b> CC0 1.0 Universal</b><img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" style="display: inline; max-width: 1em;max-height:1em;margin-left: .2em;"><img src="https://mirrors.creativecommons.org/presskit/icons/zero.svg" style="display: inline; max-width: 1em;max-height:1em;margin-left: .2em;"></a></p></div></footer></main></div></body></html>