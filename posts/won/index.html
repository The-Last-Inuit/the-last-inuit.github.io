<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  
  
    
  
  <meta name="description" content="Software engineering à la Mexicana">

  <title>World Of Noumena | Update</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://idunnowhatiamdoing.engineering/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://idunnowhatiamdoing.engineering/img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://idunnowhatiamdoing.engineering/img/apple-touch-icon.png">
  
  <style>
  @import url("https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap");

  :root {
    --bg-top: #ffffff;
    --bg-bottom: #ffffff;
    --ink: #141414;
    --muted: #6a6358;
    --link: #1d4f8c;
    --max: 81ch;
    --pad: clamp(1rem, 3vw, 2.5rem);
  }

  * {
    box-sizing: border-box;
  }

  html {
    font-size: 100%;
  }

  body {
    margin: 0;
    min-height: 100%;
    padding: var(--pad);
    background: linear-gradient(180deg, var(--bg-top), var(--bg-bottom));
    color: var(--ink);
    font-family: "Share Tech Mono", monospace;
    font-size: 16px;
    line-height: 1.5;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
  }

  main.txt {
    max-width: var(--max);
    margin: 0 auto;
  }

  pre {
    font-family: "Share Tech Mono", monospace;
  }
  pre.txt-block {
    margin: 0;
    white-space: pre;
    overflow-x: auto;
  }

  a {
    color: inherit;
    text-decoration: underline;
    text-decoration-style: dotted;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  a:visited {
    color: inherit;
  }

  a:where(:hover, :focus) {
    color: var(--link);
  }

  ::selection {
    background: rgba(29, 79, 140, 0.18);
  }
  p {
    margin: 0;
    line-height: 16pt;
  }
  ul,
  ol {
    margin: 0;
    line-height: 10pt;
  }
  li {
    line-height: 16pt;
  }
  blockquote {
    margin: 0 16pt;
    line-height: 16pt;
  }
  img {
    max-width: 64ch;
  }
  @media (prefers-reduced-motion: no-preference) {
    main.txt {
      animation: fade-in 600ms ease-out both;
    }

    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }

  @media (max-width: 700px) {
    body {
      font-size: 15px;
      padding: 1rem;
    }
    pre.txt-block {
      white-space: pre-wrap;
    }
    pre code {
      text-wrap: auto;
    }
  }
</style>

  

<link id="hl" rel="stylesheet" type="text/css" href="/hl-light.css" />



  
</head>

<body class="post">
  
  
<main class="txt">
  <pre class="txt-block">

<a id="back-link" href="/">← back</a>

<b>World Of Noumena | Update</b>
<span id="publish">Jan 15, 2026</span>

<p>This release focused on pushing the MUD toward a scalable, multi-node architecture
while adding in-world tools for lore and puzzle interaction. Below is a technical
walkthrough of the main changes and how they fit together.</p>
<p><strong>Distributed Zone Architecture</strong></p>
<p>Zones now shard across BEAM nodes using consistent hashing. The core changes:</p>
<ul>
<li><code>WorldOfNoumena.Cluster</code> computes a hash ring and assigns zone ownership.</li>
<li><code>WorldOfNoumena.Zone</code> replaces the old global room-tracking GenServer;
each zone process tracks occupants and broadcasts within its shard.</li>
<li><code>WorldOfNoumena.ZoneManager</code> starts/stops zone servers on each node as
ownership changes.</li>
<li><code>WorldOfNoumena.World</code> is now a facade that routes
<code>enter/leave/say/emote/broadcast</code> to the appropriate zone process.</li>
</ul>
<p><strong>Player Process Migration</strong></p>
<p>Players are now separate from socket connections:</p>
<ul>
<li>The TCP connection process handles login and forwards input/output.</li>
<li>The <code>Player</code> GenServer handles all commands, state, and room interactions.</li>
<li>When moving across zone boundaries, the <code>Player</code> migrates to the owning node. The connection
updates its tracked <code>player_pid</code> and continues streaming output.</li>
</ul>
<p>This isolates socket lifecycles from game state and makes cross-node movement
explicit.</p>
<p><strong>NPC and World Event Sharding</strong></p>
<p>NPCs and events now respect zone ownership:</p>
<ul>
<li><code>NPC.Manager</code> starts default NPCs only for locally owned zones and reacts
to node up/down.</li>
<li>Admin spawn commands route to the zone owner for the target room.</li>
<li>World events and room scripts are executed on nodes that own the relevant
zone or are elected leader for global events.</li>
</ul>
<p><strong>Archive Terminals and Log Indexing</strong></p>
<p>The Archives are now a first-class interface:</p>
<ul>
<li>Rooms tagged with <code>:archive</code> expose an <code>archive</code> command set.</li>
<li><code>Archives.Log</code> captures global and zone-scoped broadcasts for later
retrieval.</li>
<li>Players can search and read lore with <code>archive search</code> and <code>archive read</code>.</li>
<li>Logs are accessible via <code>archive logs</code>, with zone-specific and global views.</li>
<li>Optional external data can be loaded from JSON via <code>ARCHIVE_EXTERNAL_PATH</code>.</li>
</ul>
<p>This gives the world a queryable memory without external tooling.</p>
<p><strong>Puzzle Framework</strong></p>
<p>Rooms tagged with <code>:puzzle</code> can host lattice-style symbol puzzles:</p>
<ul>
<li><code>WorldOfNoumena.Puzzles</code> defines room-bound puzzles with symbols, prompts,
and solutions.</li>
<li><code>puzzle enter &lt;sequence&gt;</code> checks the attempt and persists solved state in
the player process.</li>
<li>Successful solves can trigger emotes or unlock additional archive entries.</li>
</ul>
<p>The puzzle system is lightweight but designed to grow into multi-step or
data-driven puzzles.</p>
<p><strong>Tooling and Operational Updates</strong></p>
<p>To make distribution testable locally:</p>
<ul>
<li><code>docker-compose.yml</code> brings up Postgres plus multiple BEAM nodes.</li>
<li><code>Makefile</code> adds cluster run targets (<code>cluster-node1</code>, <code>cluster-node2</code>,
<code>cluster-node3</code>).</li>
<li><code>TELNET_PORT</code> and <code>GATEWAY_PORT</code> can be configured at runtime per node.</li>
</ul>
<p><strong>Code Quality and Maintenance</strong></p>
<p>Several refactors landed to reduce complexity and Credo warnings:</p>
<ul>
<li>Flattened nested conditionals in player/admin flows.</li>
<li>Refactored BFS pathfinding in <code>Room</code> for readability.</li>
<li>Simplified storage transaction flow for character creation.</li>
<li>Updated map/join patterns to use <code>Enum.map_join/3</code> where appropriate.</li>
</ul>
<p><strong>Next Steps</strong></p>
<p>Immediate follow-ups:</p>
<ol>
<li>Persist puzzle progress per character instead of process memory.</li>
<li>Add richer archive ingestion (structured metadata, indexed search).</li>
<li>Expand puzzles into multi-room sequences with stateful progression.</li>
<li>Introduce zone-aware item persistence across nodes.</li>
</ol>

  </pre>
</main>

  
<script src="/js/lightense.min.js"></script>

  <script src="https://idunnowhatiamdoing.engineering/js/main.js"></script>
</body>

</html>
