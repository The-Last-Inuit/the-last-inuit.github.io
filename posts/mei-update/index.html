<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  
  
    
  
  <meta name="description" content="Software engineering à la Mexicana">

  <title>mei | updates</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://idunnowhatiamdoing.engineering/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://idunnowhatiamdoing.engineering/img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://idunnowhatiamdoing.engineering/img/apple-touch-icon.png">
  
  <style>
  @import url("https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap");

  :root {
    --bg-top: #ffffff;
    --bg-bottom: #ffffff;
    --ink: #141414;
    --muted: #6a6358;
    --link: #1d4f8c;
    --max: 88ch;
    --pad: clamp(1rem, 3vw, 2.5rem);
  }

  * {
    box-sizing: border-box;
  }

  html {
    font-size: 100%;
  }

  body {
    margin: 0;
    min-height: 100%;
    padding: var(--pad);
    background: linear-gradient(180deg, var(--bg-top), var(--bg-bottom));
    color: var(--ink);
    font-family: "Share Tech Mono", monospace;
    font-size: 16px;
    line-height: 1.5;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
  }

  main.txt {
    max-width: var(--max);
    margin: 0 auto;
  }

  pre {
    font-family: "Share Tech Mono", monospace;
  }
  pre.txt-block {
    margin: 0;
    white-space: pre;
    overflow-x: auto;
  }

  a {
    color: inherit;
    text-decoration: underline;
    text-decoration-style: dotted;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  a:visited {
    color: inherit;
  }

  a:where(:hover, :focus) {
    color: var(--link);
  }

  ::selection {
    background: rgba(29, 79, 140, 0.18);
  }
  p {
    margin: 0;
    line-height: 16pt;
  }
  ul,
  ol {
    margin: 0;
    line-height: 10pt;
  }
  li {
    line-height: 16pt;
  }
  blockquote {
    margin: 0 16pt;
    line-height: 16pt;
  }
  img {
    max-width: 64ch;
  }
  @media (prefers-reduced-motion: no-preference) {
    main.txt {
      animation: fade-in 600ms ease-out both;
    }

    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }

  @media (max-width: 700px) {
    body {
      font-size: 15px;
      padding: 1rem;
    }
  }
</style>

  

<link id="hl" rel="stylesheet" type="text/css" href="/hl-light.css" />



  
</head>

<body class="post">
  
  
<main class="txt">
  <pre class="txt-block">

<a id="back-link" href="/">← back</a>

<b>mei | updates</b>
<span id="publish">Jan 19, 2026</span>

<p><strong>Shipping a smoother Mei demo (and a few protocol fixes)</strong></p>
<p>We just cut a small but useful set of updates to the Mei prototype. This post
walks through what changed, why, and how to run the new demo flow.</p>
<p><strong>What changed</strong></p>
<ul>
<li><strong>Spec alignment:</strong> HKDF labels now match the written spec (<code>proto-v1/*</code>),
so other implementations can interop without surprises.</li>
<li><strong>Configurable relay ports:</strong> The Elixir relay reads <code>RELAY_PORT</code>/<code>PORT</code>
(default 4000). Handy for running multiple relays or avoiding conflicts.</li>
<li><strong>CLI quality-of-life:</strong> Added <code>--verbose</code> to log every relay call, and
the client now remembers relays you publish so inbox polling works even
before you have contacts.</li>
<li><strong>Demo script hardening:</strong> <code>scripts/demo.sh</code> spins up a relay on a free local
port, preserves your host <code>CARGO_HOME</code>/<code>RUSTUP_HOME</code>, supports tracing
(<code>TRACE=1</code>), and cleans up temp state unless you keep it.</li>
<li><strong>Docs and hygiene:</strong> README now documents the relay API + demo
troubleshooting, threat model calls out relay abuse/traffic-analysis
limits, and we added Elixir ignores (<code>_build/</code>, <code>deps/</code>, PLTs,
<code>.elixir_ls/</code>) to <code>.gitignore</code>.</li>
</ul>
<p><strong>Running the demo</strong></p>
<p>The demo sets up two temp clients (Alice/Bob) and a temp relay, runs the
invite/handshake, and sends a message.</p>
<p>Requirements: <code>cargo</code>, <code>mix</code>, <code>curl</code>, and <code>python3</code> on PATH. Rust toolchain
should be installed (<code>rustup default stable</code> if not).</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> from repo root</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> demo</span>
</span></code></pre>
<p>If you want to peek under the hood and keep the temp state/logs:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">TRACE</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">1</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">KEEP_STATE</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">1</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> demo</span>
</span></code></pre>
<p>Useful env toggles:</p>
<ul>
<li><code>RELAY_URL=http://127.0.0.1:5005</code> – force a specific relay URL/port
(otherwise the script finds a free port).</li>
<li><code>USE_EXISTING_RELAY=1 RELAY_URL=http://127.0.0.1:4000</code> – skip starting a
relay and point at one you already run (<code>mix run --no-halt</code>).</li>
<li><code>KEEP_STATE=1</code> – keep temp dirs under <code>/tmp</code> instead of cleaning them up.</li>
<li><code>TRACE=1</code> – bash trace for the script.</li>
</ul>
<p>During the demo the CLI prints the <code>peer=</code> value after handshake; that’s
the key to use with <code>send</code>.</p>
<p><strong>Manual quickstart (without the script)</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> start relay on a chosen port</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> relay/kaheksa</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">RELAY_PORT</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">5005</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mix</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>no-halt</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> terminal A (Alice)</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> crates/coral_cli</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> init</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> invite --relay http://127.0.0.1:5005</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> terminal B (Bob)</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> init</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> accept <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>&lt;INVITE_STRING_FROM_ALICE&gt;<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> recv</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> back to Alice</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> recv</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> send <span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span>PEER_KEY<span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>hello from alice<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Bob</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cargo</span></span><span class="z-meta z-function-call z-arguments z-shell"> run<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> recv</span>
</span></code></pre>
<p>Add <code>--verbose</code> to any CLI command if you want to see relay URLs per call.</p>

  </pre>
</main>

  
<script src="/js/lightense.min.js"></script>

  <script src="https://idunnowhatiamdoing.engineering/js/main.js"></script>
</body>

</html>
