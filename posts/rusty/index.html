<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  
  
    
  
  <meta name="description" content="Software engineering à la Mexicana">

  <title>rusty</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://idunnowhatiamdoing.engineering/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://idunnowhatiamdoing.engineering/img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://idunnowhatiamdoing.engineering/img/apple-touch-icon.png">
  
  <style>

  /* light mode colors */
  body {
    --primary-color: #5871a2;
    --primary-pale-color: #5871a233;
    --primary-decoration-color: #5871a210;
    --bg-color: #ffffff;
    --text-color: #2f3030;
    --text-pale-color: #767676;
    --text-decoration-color: #a9a9a9;
    --highlight-mark-color: #5f75b020;

    --callout-note-color: #5871a2;
    --callout-tip-color: #268556;
    --callout-important-color: #885fc9;
    --callout-warning-color: #ab6632;
    --callout-caution-color: #c64e4e;
  }

  /* dark mode colors */
  body.dark {
    --primary-color: #6f8fd1;
    --primary-pale-color: #6f8fd166;
    --primary-decoration-color: #6f8fd112;
    --bg-color: #1c1c1c;
    --text-color: #c1c1c1;
    --text-pale-color: #848484;
    --text-decoration-color: #5f5f5f;
    --highlight-mark-color: #8296cb3b;

    --callout-note-color: #6f8fd1;
    --callout-tip-color: #47976f;
    --callout-important-color: #9776cd;
    --callout-warning-color: #ad7a52;
    --callout-caution-color: #d06161;
  }

  /* typography */
  body {
    --main-font: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
    --code-font: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --homepage-max-width: 768px;
    --main-max-width: 768px;
    --avatar-size: 60px;
    --font-size: 16px;
    --line-height: 1.75;
    --img-border-radius: 0px;
    --detail-border-radius: 0px;
    --dark-mode-img-brightness: 0.75;
    --dark-mode-chart-brightness: 0.75;
    --inline-code-border-radius: 2px;
    --inline-code-bg-color: var(--primary-decoration-color);
    --block-code-border-radius: 0px;
    --block-code-border-color: var(--primary-color);
    --detail-border-color: var(--primary-color);
  }

</style>

  <link rel="stylesheet" href="https://idunnowhatiamdoing.engineering/main.css">
  

<link id="hl" rel="stylesheet" type="text/css" href="/hl-dark.css" />



  
</head>

<body class="post dark">
  
  
<div id="wrapper">
  <div id="blank"></div>
  <aside>
    
    
    <nav>
      <ul>
        
        <li>
          <a class="h2" href="#lru-cache">LRU Cache</a>
          
        </li>
        
        <li>
          <a class="h2" href="#top-k-frequent">Top-K frequent</a>
          
        </li>
        
        <li>
          <a class="h2" href="#subarray-sum-equals-k">Subarray sum equals K</a>
          
        </li>
        
        <li>
          <a class="h2" href="#merge-intervals">Merge intervals</a>
          
        </li>
        
        <li>
          <a class="h2" href="#bfs-shortest-path">BFS shortest path</a>
          
        </li>
        
        <li>
          <a class="h2" href="#binary-search-variants">Binary search variants</a>
          
        </li>
        
        <li>
          <a class="h2" href="#rate-limiter">Rate limiter</a>
          
        </li>
        
      </ul>
    </nav>
    
    
    <button id="back-to-top" aria-label="back to top">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>

    </button>
    
  </aside>
  <main>
    
<header>
  <nav>
    <a id="back-link" href="https:&#x2F;&#x2F;idunnowhatiamdoing.engineering&#x2F;posts">← back</a>
  </nav>
</header>


    <div>
      
      
      
      
      <div id="copy-cfg" style="display: none;" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
"></div>
      
      <article class="prose">
        <h1>rusty</h1>
        <div id="post-info">
          <div id="date">
            <span id="publish">Jan 4, 2026</span>
            </div>

          
        </div>

        
        

        

        <p>I'm a bit <strong>rust</strong>y, and in a few days I have a technical interview. Time to drag those skeletons into the sun for a proper sunbath.</p>
<p>We are going to code (raw-dogging mode) a few elixir modules:</p>
<ul>
<li>LRU Cache</li>
<li>Top-K frequent (map + heap/PQ)</li>
<li>Subarray sum equals K (prefix sums)</li>
<li>Merge intervals</li>
<li>BFS shortest path (grid)</li>
<li>Binary search variants</li>
<li>Rate limiter (token bucket, in-memory)</li>
</ul>
<h4 id="lru-cache">LRU Cache<a class="zola-anchor" href="#lru-cache" aria-label="Anchor link for: lru-cache" style="visibility: hidden;"></a>
</h4>
<p>link: <a href="raw-dogged-lru.exs">code</a></p>
<p>To run:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> elixir raw-dogged-lru.exs</span>
</span></code></pre>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">LRU</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@moduledoc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Immutable (pure) LRU cache.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  This cache is **persistent/immutable**: every `get/2` returns `{value, new_lru}` and every
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  `put/3` returns a **new** `LRU.t()`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Internally it maintains:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - `k2id`: key -&gt; node id
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - `nodes`: node id -&gt; node data (`%{k, v, prev, next}`)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - `head`/`tail`: ids of a doubly-linked list in **MRU -&gt; LRU** order
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Average complexity:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - `get/2`: O(1)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - `put/3`: O(1)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru = LRU.new(2) |&gt; LRU.put(:a, 1) |&gt; LRU.put(:b, 2)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {1, lru} = LRU.get(lru, :a)     # :a becomes MRU
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru = LRU.put(lru, :c, 3)       # evicts LRU (:b)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {nil, _} = LRU.get(lru, :b)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {1, _} = LRU.get(lru, :a)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">alias</span> <span class="z-variable z-language z-elixir">__MODULE__</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">as<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-entity z-name z-class z-elixir">LRU</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;Cache key.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> key :: term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;Cache value.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> value :: term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;Internal node id.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> id :: pos_integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;Internal doubly-linked-list node.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> n :: %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">k<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> key<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">v<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> value<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">prev<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">next<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-language z-elixir">nil</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">        <span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@typedoc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  LRU cache struct.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Invariants (expected to hold after any public operation):
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - `map_size(k2id) == map_size(nodes)`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - If size == 0: `head == nil` and `tail == nil`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - If size &gt; 0: `head` and `tail` are valid node ids, and list pointers are consistent
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> t :: %<span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> non_neg_integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">k2id<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>optional<span class="z-punctuation z-section z-function z-elixir">(</span>key<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-map-pair z-elixir">=&gt;</span> id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">nodes<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>optional<span class="z-punctuation z-section z-function z-elixir">(</span>id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-map-pair z-elixir">=&gt;</span> n<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">head<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">tail<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">next_id<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">        <span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">defstruct</span> <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">            <span class="z-constant z-other z-keywords z-elixir">k2id<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">            <span class="z-constant z-other z-keywords z-elixir">nodes<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">            <span class="z-constant z-other z-keywords z-elixir">head<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">            <span class="z-constant z-other z-keywords z-elixir">tail<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">            <span class="z-constant z-other z-keywords z-elixir">next_id<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Creates a new cache with the given `capacity`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Capacity may be `0` (a cache that never stores anything).
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru = LRU.new(0)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru.cap
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      0
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru = LRU.new(2) |&gt; LRU.put(:a, 1)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {1, _} = LRU.get(lru, :a)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> new<span class="z-punctuation z-section z-function z-elixir">(</span>non_neg_integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">new</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>capacity<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>capacity<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> capacity <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> %<span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> capacity<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Reads `key` from the cache.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns `{value_or_nil, new_lru}`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  If the key exists, it is promoted to **most recently used**.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru = LRU.new(2) |&gt; LRU.put(:a, 1) |&gt; LRU.put(:b, 2)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {1, lru} = LRU.get(lru, :a)  # :a becomes MRU
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru = LRU.put(lru, :c, 3)    # evicts :b (LRU)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {nil, _} = LRU.get(lru, :b)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> get<span class="z-punctuation z-section z-function z-elixir">(</span>t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>value<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">get</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">case</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>k2id<span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      <span class="z-constant z-language z-elixir">nil</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> lru<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      id <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        v <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-section z-array z-elixir">[</span>id<span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-method z-elixir">.</span>v
</span><span class="z-source z-elixir">        lru2 <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> detach<span class="z-punctuation z-section z-function z-elixir">(</span>id<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> attach_head<span class="z-punctuation z-section z-function z-elixir">(</span>id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>v<span class="z-punctuation z-separator z-sequence z-elixir">,</span> lru2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Inserts or updates `key` with `val`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - New keys are inserted as **MRU**.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - Existing keys are updated and promoted to **MRU**.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  - If inserting exceeds capacity, the **LRU** entry is evicted.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  If `cap == 0`, this is a no-op.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru = LRU.new(1) |&gt; LRU.put(:a, 1) |&gt; LRU.put(:b, 2)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {nil, _} = LRU.get(lru, :a)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {2, _} = LRU.get(lru, :b)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; lru = LRU.new(2) |&gt; LRU.put(:a, 1) |&gt; LRU.put(:a, 99)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {99, _} = LRU.get(lru, :a)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> put<span class="z-punctuation z-section z-function z-elixir">(</span>t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> value<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">put</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>%<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru<span class="z-punctuation z-separator z-object z-elixir">,</span> _k<span class="z-punctuation z-separator z-object z-elixir">,</span> _v<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> lru
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">put</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-separator z-object z-elixir">,</span> val<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">case</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>k2id<span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      <span class="z-constant z-language z-elixir">nil</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>id<span class="z-punctuation z-separator z-sequence z-elixir">,</span> lru1<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> alloc_node<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-separator z-object z-elixir">,</span> val<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        lru1 <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> attach_head<span class="z-punctuation z-section z-function z-elixir">(</span>id<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> evict_if_needed<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      id <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        lru
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> put_in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>v</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> val<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> detach<span class="z-punctuation z-section z-function z-elixir">(</span>id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> attach_head<span class="z-punctuation z-section z-function z-elixir">(</span>id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> alloc_node<span class="z-punctuation z-section z-function z-elixir">(</span>t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> value<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">alloc_node</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-separator z-object z-elixir">,</span> val<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    id <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>next_id
</span><span class="z-source z-elixir">    node <span class="z-keyword z-operator z-assignment z-elixir">=</span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-keywords z-elixir">k<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> key<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">v<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> val<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">prev<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">next<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru2 <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      lru
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>update!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>k2id</span><span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>update!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> node<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>next_id</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>id<span class="z-punctuation z-separator z-sequence z-elixir">,</span> lru2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> detach<span class="z-punctuation z-section z-function z-elixir">(</span>t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">detach</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    node <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-section z-array z-elixir">[</span>id<span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    prev <span class="z-keyword z-operator z-assignment z-elixir">=</span> node<span class="z-punctuation z-separator z-method z-elixir">.</span>prev
</span><span class="z-source z-elixir">    nxt <span class="z-keyword z-operator z-assignment z-elixir">=</span> node<span class="z-punctuation z-separator z-method z-elixir">.</span>next
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      lru
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> put_in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>prev</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> put_in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>next</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">if</span> prev <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">        put_in<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> prev<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>next</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> nxt<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">        lru
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">if</span> nxt <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">        put_in<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> nxt<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>prev</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> prev<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">        lru
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-keyword z-control z-elixir">if</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>head <span class="z-keyword z-operator z-comparison z-elixir">==</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>lru <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-other z-keywords z-elixir">head<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> nxt<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> lru
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-keyword z-control z-elixir">if</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>tail <span class="z-keyword z-operator z-comparison z-elixir">==</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>lru <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-other z-keywords z-elixir">tail<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> prev<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> lru
</span><span class="z-source z-elixir">    lru
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> attach_head<span class="z-punctuation z-section z-function z-elixir">(</span>t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">attach_head</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>%<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-keywords z-elixir">head<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru<span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    lru
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> put_in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>prev</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> put_in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>next</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>head</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>tail</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">attach_head</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    old <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>head
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> put_in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>prev</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> put_in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>next</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> old<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> put_in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-entity z-name z-class z-elixir">Access</span><span class="z-punctuation z-separator z-method z-elixir">.</span>key!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> old<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>prev</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>head</span><span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> evict_if_needed<span class="z-punctuation z-section z-function z-elixir">(</span>t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">evict_if_needed</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">if</span> map_size<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>k2id<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">&lt;=</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>cap <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      lru
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">      tid <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>tail
</span><span class="z-source z-elixir">      key <span class="z-keyword z-operator z-assignment z-elixir">=</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-section z-array z-elixir">[</span>tid<span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-method z-elixir">.</span>k
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      lru
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> detach<span class="z-punctuation z-section z-function z-elixir">(</span>tid<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>update!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>k2id</span><span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>delete<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> key<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>update!<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>nodes</span><span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>delete<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> tid<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span>start<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">LRUTest</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">use</span> <span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-entity z-name z-class z-elixir">Case</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">async<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">keys</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>k2id <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>keys<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">assert_integrity</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    size <span class="z-keyword z-operator z-assignment z-elixir">=</span> map_size<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>k2id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert map_size<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> size
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>each<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>k2id<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>k<span class="z-punctuation z-separator z-sequence z-elixir">,</span> id<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">      node <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>fetch!<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert node<span class="z-punctuation z-separator z-method z-elixir">.</span>k <span class="z-keyword z-operator z-comparison z-elixir">==</span> k
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">cond</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      size <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        assert lru<span class="z-punctuation z-separator z-method z-elixir">.</span>head <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">nil</span>
</span><span class="z-source z-elixir">        assert lru<span class="z-punctuation z-separator z-method z-elixir">.</span>tail <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">nil</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        assert is_integer<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>head<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        assert is_integer<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>tail<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        assert <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>has_key?<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-separator z-object z-elixir">,</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>head<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        assert <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>has_key?<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-separator z-object z-elixir">,</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>tail<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        head_node <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>fetch!<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-separator z-object z-elixir">,</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>head<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        tail_node <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>fetch!<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-separator z-object z-elixir">,</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>tail<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        assert head_node<span class="z-punctuation z-separator z-method z-elixir">.</span>prev <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">nil</span>
</span><span class="z-source z-elixir">        assert tail_node<span class="z-punctuation z-separator z-method z-elixir">.</span>next <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">nil</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ids<span class="z-punctuation z-separator z-sequence z-elixir">,</span> last<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">          <span class="z-entity z-name z-class z-elixir">Stream</span><span class="z-punctuation z-separator z-method z-elixir">.</span>unfold<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>head<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span>
</span><span class="z-source z-elixir">            <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _prev<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">              <span class="z-constant z-language z-elixir">nil</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">            <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>id<span class="z-punctuation z-separator z-sequence z-elixir">,</span> prev<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">              node <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>fetch!<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>nodes<span class="z-punctuation z-separator z-object z-elixir">,</span> id<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">              assert node<span class="z-punctuation z-separator z-method z-elixir">.</span>prev <span class="z-keyword z-operator z-comparison z-elixir">==</span> prev
</span><span class="z-source z-elixir">              <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>id<span class="z-punctuation z-separator z-sequence z-elixir">,</span> node<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>node<span class="z-punctuation z-separator z-method z-elixir">.</span>next<span class="z-punctuation z-separator z-sequence z-elixir">,</span> id<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>id<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _node<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>acc<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span>id <span class="z-keyword z-operator z-other z-elixir">|</span> acc<span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> id<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        ids <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reverse<span class="z-punctuation z-section z-function z-elixir">(</span>ids<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        assert <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>uniq<span class="z-punctuation z-section z-function z-elixir">(</span>ids<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> ids
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        assert length<span class="z-punctuation z-section z-function z-elixir">(</span>ids<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> size
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        assert last <span class="z-keyword z-operator z-comparison z-elixir">==</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>tail
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>new/1 sets capacity and empty state<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert lru<span class="z-punctuation z-separator z-method z-elixir">.</span>cap <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">3</span>
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>cap=0: put is no-op and get always misses<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    lru2 <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert lru2 <span class="z-keyword z-operator z-comparison z-elixir">==</span> lru
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-variable z-other z-pin z-elixir"><span class="z-keyword z-operator z-pin z-elixir">^</span>lru</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>get miss returns {nil, same_lru}<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-variable z-other z-pin z-elixir"><span class="z-keyword z-operator z-pin z-elixir">^</span>lru</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>missing</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>put inserts and get hits; get promotes to MRU<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> lru2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru2<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru3 <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span>lru2<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>c</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru3<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru3<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru3<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru3<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>c</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>put updates existing key value and promotes to MRU without changing size<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert keys<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru2 <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">99</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert keys<span class="z-punctuation z-section z-function z-elixir">(</span>lru2<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru2<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">99</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru2<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>capacity = 1 evicts on second distinct insert<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    assert <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>longer sequence maintains invariants and never exceeds capacity<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    lru0 <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    lru <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-keyword z-operator z-range z-elixir">..</span><span class="z-constant z-numeric z-elixir">50</span><span class="z-punctuation z-separator z-object z-elixir">,</span> lru0<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> i<span class="z-punctuation z-separator z-object z-elixir">,</span> lru <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        lru <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">          lru
</span><span class="z-source z-elixir">          <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span>rem<span class="z-punctuation z-section z-function z-elixir">(</span>i<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> i<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-comment z-line z-number-sign z-elixir"><span class="z-punctuation z-definition z-comment z-elixir">#</span> keys: 0..4
</span></span><span class="z-source z-elixir">          <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> lru <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">                <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>_v<span class="z-punctuation z-separator z-sequence z-elixir">,</span> lru<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">LRU</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-object z-elixir">,</span> rem<span class="z-punctuation z-section z-function z-elixir">(</span>i <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">                lru
</span><span class="z-source z-elixir">              <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        assert map_size<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-separator z-method z-elixir">.</span>k2id<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">&lt;=</span> lru<span class="z-punctuation z-separator z-method z-elixir">.</span>cap
</span><span class="z-source z-elixir">        lru
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    assert_integrity<span class="z-punctuation z-section z-function z-elixir">(</span>lru<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<h4 id="top-k-frequent">Top-K frequent<a class="zola-anchor" href="#top-k-frequent" aria-label="Anchor link for: top-k-frequent" style="visibility: hidden;"></a>
</h4>
<p>link: <a href="raw-dogged-topk.exs">code</a></p>
<p>To run:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> elixir raw-dogged-topk.exs</span>
</span></code></pre>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">TopK</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@moduledoc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Utilities for selecting the `k` most frequent **distinct** values from a list.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Approach
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Build a frequency map in `O(n)`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Keep a min-priority set (size ≤ `k`) using `:gb_sets` keyed by `{count, seq, value}`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">    When the set grows beyond `k`, the smallest `{count, seq, value}` is removed.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Notes on ties
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  If multiple values share the same frequency, the function still returns a valid top-`k`,
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  but the *relative order among tied items is unspecified*.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;A value from the input list.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> value :: term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns up to `k` values that occur most frequently in `nums`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  The result is ordered from **most frequent to least frequent**.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Ties have unspecified order.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; TopK.top_k_frequent([1, 1, 1, 2, 2, 3], 2)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      [1, 2]
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; TopK.top_k_frequent([:a, :b, :a], 10) |&gt; Enum.sort()
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      [:a, :b]
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; TopK.top_k_frequent([], 3)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      []
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; TopK.top_k_frequent([1, 2, 3], 0)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      []
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>value<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: <span class="z-punctuation z-section z-array z-elixir">[</span>value<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">top_k_frequent</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>_nums<span class="z-punctuation z-separator z-object z-elixir">,</span> k<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>k<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> k <span class="z-keyword z-operator z-comparison z-elixir">&lt;=</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">top_k_frequent</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> k<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_list</span><span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>k<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    freq <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> acc <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>update<span class="z-punctuation z-section z-function z-elixir">(</span>acc<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span> <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>set<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _seq<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span>freq<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>gb_sets</span><span class="z-punctuation z-separator z-method z-elixir">.</span>empty<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>v<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>set<span class="z-punctuation z-separator z-sequence z-elixir">,</span> seq<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        seq <span class="z-keyword z-operator z-assignment z-elixir">=</span> seq <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">        set <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>gb_sets</span><span class="z-punctuation z-separator z-method z-elixir">.</span>add<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>c<span class="z-punctuation z-separator z-sequence z-elixir">,</span> seq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> v<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> set<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        set <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">if</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>gb_sets</span><span class="z-punctuation z-separator z-method z-elixir">.</span>size<span class="z-punctuation z-section z-function z-elixir">(</span>set<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">&gt;</span> k <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">            <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>_smallest<span class="z-punctuation z-separator z-sequence z-elixir">,</span> set2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>gb_sets</span><span class="z-punctuation z-separator z-method z-elixir">.</span>take_smallest<span class="z-punctuation z-section z-function z-elixir">(</span>set<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">            set2
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">            set
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>set<span class="z-punctuation z-separator z-sequence z-elixir">,</span> seq<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    extract_desc<span class="z-punctuation z-section z-function z-elixir">(</span>set<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> extract_desc<span class="z-punctuation z-section z-function z-elixir">(</span>term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span>value<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: <span class="z-punctuation z-section z-array z-elixir">[</span>value<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">extract_desc</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>set<span class="z-punctuation z-separator z-object z-elixir">,</span> acc<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">if</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>gb_sets</span><span class="z-punctuation z-separator z-method z-elixir">.</span>is_empty<span class="z-punctuation z-section z-function z-elixir">(</span>set<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reverse<span class="z-punctuation z-section z-function z-elixir">(</span>acc<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>_c<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _seq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> v<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> set2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>gb_sets</span><span class="z-punctuation z-separator z-method z-elixir">.</span>take_largest<span class="z-punctuation z-section z-function z-elixir">(</span>set<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      extract_desc<span class="z-punctuation z-section z-function z-elixir">(</span>set2<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span>v <span class="z-keyword z-operator z-other z-elixir">|</span> acc<span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span>start<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">TopKTest</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">use</span> <span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-entity z-name z-class z-elixir">Case</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">async<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>top_k_frequent/2<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>returns [] when k &lt;= 0<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">TopK</span><span class="z-punctuation z-separator z-method z-elixir">.</span>top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">TopK</span><span class="z-punctuation z-separator z-method z-elixir">.</span>top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>returns [] for empty input<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">TopK</span><span class="z-punctuation z-separator z-method z-elixir">.</span>top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">TopK</span><span class="z-punctuation z-separator z-method z-elixir">.</span>top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>returns the k most frequent values, ordered by frequency desc<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      nums <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">TopK</span><span class="z-punctuation z-separator z-method z-elixir">.</span>top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>when k exceeds number of distinct values, returns all distinct values<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      nums <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      res <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TopK</span><span class="z-punctuation z-separator z-method z-elixir">.</span>top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert length<span class="z-punctuation z-section z-function z-elixir">(</span>res<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">2</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span>res<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>works with non-numeric terms<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      nums <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>x<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>y<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>x<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>z<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>x<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>y<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">TopK</span><span class="z-punctuation z-separator z-method z-elixir">.</span>top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>x<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>y<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>ties: returns any valid top-k (order among ties unspecified)<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      nums <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      res <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TopK</span><span class="z-punctuation z-separator z-method z-elixir">.</span>top_k_frequent<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert length<span class="z-punctuation z-section z-function z-elixir">(</span>res<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">2</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>uniq<span class="z-punctuation z-section z-function z-elixir">(</span>res<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> res
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>all?<span class="z-punctuation z-section z-function z-elixir">(</span>res<span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span> <span class="z-keyword z-operator z-elixir">in</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      freq <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>frequencies<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      kth <span class="z-keyword z-operator z-assignment z-elixir">=</span> freq <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>values<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>desc</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>at<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>all?<span class="z-punctuation z-section z-function z-elixir">(</span>res<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> v <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>fetch!<span class="z-punctuation z-section z-function z-elixir">(</span>freq<span class="z-punctuation z-separator z-object z-elixir">,</span> v<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> kth <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<h4 id="subarray-sum-equals-k">Subarray sum equals K<a class="zola-anchor" href="#subarray-sum-equals-k" aria-label="Anchor link for: subarray-sum-equals-k" style="visibility: hidden;"></a>
</h4>
<p>link: <a href="raw-dogged-sub.exs">code</a></p>
<p>To run:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> elixir raw-dogged-sub.exs</span>
</span></code></pre>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">SubarraySum</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@moduledoc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Counts how many contiguous subarrays sum to a target `k`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Idea
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Use prefix sums and a frequency map:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Let `prefix[i] = nums[0] + ... + nums[i]`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * A subarray `(j+1..i)` sums to `k` iff `prefix[i] - prefix[j] = k`,
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">    i.e. `prefix[j] = prefix[i] - k`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Keep a map `seen` from prefix sum to how many times we&#39;ve seen it so far.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Time: `O(n)`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Space: `O(n)` (in the worst case, all prefix sums are distinct)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Works with negative numbers and zeros.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;An integer input list element.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> num :: integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns the number of contiguous subarrays of `nums` whose sum equals `k`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; SubarraySum.count([1, 1, 1], 2)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      2
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; SubarraySum.count([1, 2, 3], 3)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      2
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; SubarraySum.count([1, -1, 0], 0)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      3
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; SubarraySum.count([], 0)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      0
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>num<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: non_neg_integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">count</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> k<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_list</span><span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>k<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ans<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _prefix<span class="z-punctuation z-separator z-sequence z-elixir">,</span> _seen<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-operator z-map-pair z-elixir">=&gt;</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ans<span class="z-punctuation z-separator z-sequence z-elixir">,</span> prefix<span class="z-punctuation z-separator z-sequence z-elixir">,</span> seen<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        prefix <span class="z-keyword z-operator z-assignment z-elixir">=</span> prefix <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> x
</span><span class="z-source z-elixir">        ans <span class="z-keyword z-operator z-assignment z-elixir">=</span> ans <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>get<span class="z-punctuation z-section z-function z-elixir">(</span>seen<span class="z-punctuation z-separator z-object z-elixir">,</span> prefix <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> k<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        seen <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">Map</span><span class="z-punctuation z-separator z-method z-elixir">.</span>update<span class="z-punctuation z-section z-function z-elixir">(</span>seen<span class="z-punctuation z-separator z-object z-elixir">,</span> prefix<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> &amp;<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-capture z-elixir"><span class="z-keyword z-operator z-capture z-elixir">&amp;</span>1</span> <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ans<span class="z-punctuation z-separator z-sequence z-elixir">,</span> prefix<span class="z-punctuation z-separator z-sequence z-elixir">,</span> seen<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    ans
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span>start<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">SubarraySumTest</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">use</span> <span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-entity z-name z-class z-elixir">Case</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">async<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>count/2<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>classic example<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">2</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>multiple matches across different lengths<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">2</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>handles negative numbers<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">3</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>all zeros: many subarrays match<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">10</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>single element cases<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>empty list<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">7</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>property check vs brute force on small random-ish inputs<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      cases <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">7</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">7</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>each<span class="z-punctuation z-section z-function z-elixir">(</span>cases<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>nums<span class="z-punctuation z-separator z-sequence z-elixir">,</span> k<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        assert <span class="z-entity z-name z-class z-elixir">SubarraySum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>count<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> k<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> brute_count<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> k<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">brute_count</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>nums<span class="z-punctuation z-separator z-object z-elixir">,</span> k<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    n <span class="z-keyword z-operator z-assignment z-elixir">=</span> length<span class="z-punctuation z-section z-function z-elixir">(</span>nums<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">for</span> i <span class="z-keyword z-operator z-arrow z-elixir">&lt;-</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-keyword z-operator z-range z-elixir">..</span><span class="z-punctuation z-section z-function z-elixir">(</span>n <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        j <span class="z-keyword z-operator z-arrow z-elixir">&lt;-</span> i<span class="z-keyword z-operator z-range z-elixir">..</span><span class="z-punctuation z-section z-function z-elixir">(</span>n <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-constant z-other z-keywords z-elixir">reduce<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      acc <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        sum <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">          nums
</span><span class="z-source z-elixir">          <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>slice<span class="z-punctuation z-section z-function z-elixir">(</span>i<span class="z-keyword z-operator z-range z-elixir">..</span>j<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sum<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        <span class="z-keyword z-control z-elixir">if</span> sum <span class="z-keyword z-operator z-comparison z-elixir">==</span> k<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> acc <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> acc
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<h4 id="merge-intervals">Merge intervals<a class="zola-anchor" href="#merge-intervals" aria-label="Anchor link for: merge-intervals" style="visibility: hidden;"></a>
</h4>
<p>link: <a href="raw-dogged-merge.exs">code</a></p>
<p>To run:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> elixir raw-dogged-merge.exs</span>
</span></code></pre>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">Intervals</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@moduledoc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Merges overlapping (or touching) intervals.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Intervals are represented as `{start, end}` tuples (typically integers).
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  The merge rule used here is:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Two intervals overlap/touch if `next_start &lt;= prev_end`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * When they do, they merge into `{prev_start, max(prev_end, next_end)}`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  The result is sorted by start (and end) in ascending order.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Complexity
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Time: `O(n log n)` due to sorting
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Space: `O(n)` for the output
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Assumptions / input validation
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  This module assumes each interval is a 2-tuple and that `start &lt;= end`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  If you may receive reversed intervals like `{5, 2}`, normalize them before calling `merge/1`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;An interval represented as `{start, end}`.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> interval<span class="z-punctuation z-section z-function z-elixir">(</span>t<span class="z-punctuation z-section z-function z-elixir">)</span> :: <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>t<span class="z-punctuation z-separator z-sequence z-elixir">,</span> t<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> interval :: interval<span class="z-punctuation z-section z-function z-elixir">(</span>integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Merges a list of intervals.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns a list of merged intervals, sorted ascending.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Touching intervals are merged:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; Intervals.merge([{1, 2}, {2, 3}])
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      [{1, 3}]
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; Intervals.merge([])
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      []
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; Intervals.merge([{1, 3}, {2, 6}, {8, 10}, {15, 18}])
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      [{1, 6}, {8, 10}, {15, 18}]
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; Intervals.merge([{5, 7}, {1, 2}, {3, 4}])
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      [{1, 2}, {3, 4}, {5, 7}]
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>interval<span class="z-punctuation z-section z-function z-elixir">(</span>integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: <span class="z-punctuation z-section z-array z-elixir">[</span>interval<span class="z-punctuation z-section z-function z-elixir">(</span>integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">merge</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">merge</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>intervals<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_list</span><span class="z-punctuation z-section z-function z-elixir">(</span>intervals<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    intervals
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> acc <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">case</span> acc <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">          <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ps<span class="z-punctuation z-separator z-sequence z-elixir">,</span> pe<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">|</span> rest<span class="z-punctuation z-section z-array z-elixir">]</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">if</span> s <span class="z-keyword z-operator z-comparison z-elixir">&lt;=</span> pe <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">            <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ps<span class="z-punctuation z-separator z-sequence z-elixir">,</span> max<span class="z-punctuation z-section z-function z-elixir">(</span>pe<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">|</span> rest<span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">            <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">|</span> acc<span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reverse<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span>start<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">IntervalsTest</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">use</span> <span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-entity z-name z-class z-elixir">Case</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">async<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>merge/1<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>empty input<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>single interval<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>already sorted, overlapping<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">6</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">8</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">15</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">18</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span>
</span><span class="z-source z-elixir">               <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">6</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">8</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">15</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">18</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>unsorted input is handled<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">8</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">6</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">6</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">8</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>non-overlapping intervals remain separate and sorted<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">7</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">7</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>touching intervals merge (s &lt;= previous_end)<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>contained intervals collapse into the outer one<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">8</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>duplicates collapse<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>property check vs brute merge on small cases<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      cases <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">6</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">6</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>each<span class="z-punctuation z-section z-function z-elixir">(</span>cases<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> intervals <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        assert <span class="z-entity z-name z-class z-elixir">Intervals</span><span class="z-punctuation z-separator z-method z-elixir">.</span>merge<span class="z-punctuation z-section z-function z-elixir">(</span>intervals<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> brute_merge<span class="z-punctuation z-section z-function z-elixir">(</span>intervals<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">brute_merge</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>intervals<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    intervals
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>sort_by<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> acc <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">case</span> acc <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">          <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ps<span class="z-punctuation z-separator z-sequence z-elixir">,</span> pe<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">|</span> rest<span class="z-punctuation z-section z-array z-elixir">]</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">if</span> s <span class="z-keyword z-operator z-comparison z-elixir">&lt;=</span> pe <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">            <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ps<span class="z-punctuation z-separator z-sequence z-elixir">,</span> max<span class="z-punctuation z-section z-function z-elixir">(</span>pe<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">|</span> rest<span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">            <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> e<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">|</span> acc<span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reverse<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<h4 id="bfs-shortest-path">BFS shortest path<a class="zola-anchor" href="#bfs-shortest-path" aria-label="Anchor link for: bfs-shortest-path" style="visibility: hidden;"></a>
</h4>
<p>link: <a href="raw-dogged-bfs.exs">code</a></p>
<p>To run:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> elixir raw-dogged-bfs.exs</span>
</span></code></pre>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">BFSGrid</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@moduledoc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Shortest path on a 2D grid using BFS (4-directional movement).
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  The grid is a list of rows, where each cell is:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * `0` = open
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * `1` = blocked (wall)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Coordinates are `{row, col}` with zero-based indices.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns the length (number of steps) of the shortest path from `start` to `goal`,
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  or `-1` if no path exists or the input is invalid.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Notes / assumptions
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Requires a rectangular grid (all rows same length).
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Movement is 4-neighborhood: up, down, left, right (no diagonals).
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * If `start == goal`, returns `0` (as long as the cell is in-bounds and not blocked).
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Complexity
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  BFS visits each reachable cell at most once.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Time: `O(rows * cols)`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Space: `O(rows * cols)` for the queue + visited set
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;Grid where 0=open and 1=blocked.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> grid :: <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;Coordinate in `{row, col}` form (0-based).&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> coord :: <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Computes the shortest path length from `{sr, sc}` to `{gr, gc}`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns `-1` when:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * grid is empty
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * start/goal is out of bounds
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * start/goal is blocked (`1`)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * no path exists
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; grid = [
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      ...&gt;   [0, 0, 0],
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      ...&gt;   [1, 1, 0],
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      ...&gt;   [0, 0, 0]
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      ...&gt; ]
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BFSGrid.shortest_path(grid, {0, 0}, {2, 2})
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      4
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BFSGrid.shortest_path([], {0, 0}, {0, 0})
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      -1
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BFSGrid.shortest_path([[1]], {0, 0}, {0, 0})
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      -1
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BFSGrid.shortest_path([[0]], {0, 0}, {0, 0})
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      0
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> coord<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> coord<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">shortest_path</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>sr<span class="z-punctuation z-separator z-sequence z-elixir">,</span> sc<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>gr<span class="z-punctuation z-separator z-sequence z-elixir">,</span> gc<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">      <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_list</span><span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>sr<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>sc<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>gr<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">             <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>gc<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    r <span class="z-keyword z-operator z-assignment z-elixir">=</span> length<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">if</span> r <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> do_bfs<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>sr<span class="z-punctuation z-separator z-sequence z-elixir">,</span> sc<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>gr<span class="z-punctuation z-separator z-sequence z-elixir">,</span> gc<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> do_bfs<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> coord<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> coord<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">do_bfs</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> start<span class="z-punctuation z-separator z-object z-elixir">,</span> goal<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    rows <span class="z-keyword z-operator z-assignment z-elixir">=</span> length<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    cols <span class="z-keyword z-operator z-assignment z-elixir">=</span> length<span class="z-punctuation z-section z-function z-elixir">(</span>hd<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    in_bounds <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>r<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> r <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> <span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> r <span class="z-keyword z-operator z-comparison z-elixir">&lt;</span> rows <span class="z-keyword z-operator z-logical z-elixir">and</span> c <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> <span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> c <span class="z-keyword z-operator z-comparison z-elixir">&lt;</span> cols <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">    cell <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>r<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> grid <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>at<span class="z-punctuation z-section z-function z-elixir">(</span>r<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>at<span class="z-punctuation z-section z-function z-elixir">(</span>c<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">cond</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-logical z-elixir">not</span> in_bounds<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>start<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">or</span> <span class="z-keyword z-operator z-logical z-elixir">not</span> in_bounds<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>goal<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      cell<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>start<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span> <span class="z-keyword z-operator z-logical z-elixir">or</span> cell<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>goal<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      start <span class="z-keyword z-operator z-comparison z-elixir">==</span> goal <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        q <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>start<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        vis <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>start<span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        bfs_loop<span class="z-punctuation z-section z-function z-elixir">(</span>q<span class="z-punctuation z-separator z-object z-elixir">,</span> vis<span class="z-punctuation z-separator z-object z-elixir">,</span> in_bounds<span class="z-punctuation z-separator z-object z-elixir">,</span> cell<span class="z-punctuation z-separator z-object z-elixir">,</span> goal<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> bfs_loop<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>queue<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-function z-elixir">(</span>coord<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> boolean<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-function z-elixir">(</span>coord<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> coord<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> ::
</span><span class="z-source z-elixir">          integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">bfs_loop</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>q<span class="z-punctuation z-separator z-object z-elixir">,</span> vis<span class="z-punctuation z-separator z-object z-elixir">,</span> in_bounds<span class="z-punctuation z-separator z-object z-elixir">,</span> cell<span class="z-punctuation z-separator z-object z-elixir">,</span> goal<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">case</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>out<span class="z-punctuation z-section z-function z-elixir">(</span>q<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>value</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>r<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> d<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> q2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        dirs <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>q3<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vis3<span class="z-punctuation z-separator z-sequence z-elixir">,</span> found<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">          <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span>dirs<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>q2<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vis<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>dr<span class="z-punctuation z-separator z-sequence z-elixir">,</span> dc<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-separator z-sequence z-elixir">,</span> found<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">            <span class="z-keyword z-control z-elixir">if</span> found <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">              <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-separator z-sequence z-elixir">,</span> found<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">            <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">              nxt <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>r <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> dr<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> dc<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">              <span class="z-keyword z-control z-elixir">cond</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">                <span class="z-keyword z-operator z-logical z-elixir">not</span> in_bounds<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>nxt<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">                <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>member?<span class="z-punctuation z-section z-function z-elixir">(</span>vv<span class="z-punctuation z-separator z-object z-elixir">,</span> nxt<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">                cell<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>nxt<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">                nxt <span class="z-keyword z-operator z-comparison z-elixir">==</span> goal <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-separator z-sequence z-elixir">,</span> d <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">                <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>nxt<span class="z-punctuation z-separator z-sequence z-elixir">,</span> d <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> qq<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span>vv<span class="z-punctuation z-separator z-sequence z-elixir">,</span> nxt<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-language z-elixir">nil</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">              <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">            <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">          <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">        <span class="z-keyword z-control z-elixir">if</span> found<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> found<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> bfs_loop<span class="z-punctuation z-section z-function z-elixir">(</span>q3<span class="z-punctuation z-separator z-object z-elixir">,</span> vis3<span class="z-punctuation z-separator z-object z-elixir">,</span> in_bounds<span class="z-punctuation z-separator z-object z-elixir">,</span> cell<span class="z-punctuation z-separator z-object z-elixir">,</span> goal<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>empty</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span>start<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">BFSGridTest</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">use</span> <span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-entity z-name z-class z-elixir">Case</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">async<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>shortest_path/3<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>empty grid returns -1<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>start == goal returns 0 when in-bounds and open<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>start == goal returns -1 when blocked<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>out-of-bounds start or goal returns -1<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      grid <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>blocked start or goal returns -1<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      grid <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      grid2 <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid2<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>finds a shortest path in a simple open grid (Manhattan distance)<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      grid <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">4</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">2</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>navigates around walls<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      grid <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">4</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>returns -1 when no path exists<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      grid <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>handles non-square grids<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      grid <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>agrees with a brute-force BFS implementation on small cases<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      cases <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>each<span class="z-punctuation z-section z-function z-elixir">(</span>cases<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>grid<span class="z-punctuation z-separator z-sequence z-elixir">,</span> s<span class="z-punctuation z-separator z-sequence z-elixir">,</span> g<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        assert <span class="z-entity z-name z-class z-elixir">BFSGrid</span><span class="z-punctuation z-separator z-method z-elixir">.</span>shortest_path<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> s<span class="z-punctuation z-separator z-object z-elixir">,</span> g<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> brute_bfs<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> s<span class="z-punctuation z-separator z-object z-elixir">,</span> g<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">brute_bfs</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>grid<span class="z-punctuation z-separator z-object z-elixir">,</span> start<span class="z-punctuation z-separator z-object z-elixir">,</span> goal<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    rows <span class="z-keyword z-operator z-assignment z-elixir">=</span> length<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">if</span> rows <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>ok</span>
</span><span class="z-source z-elixir">    cols <span class="z-keyword z-operator z-assignment z-elixir">=</span> length<span class="z-punctuation z-section z-function z-elixir">(</span>hd<span class="z-punctuation z-section z-function z-elixir">(</span>grid<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    in_bounds? <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>r<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> r <span class="z-keyword z-operator z-elixir">in</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-keyword z-operator z-range z-elixir">..</span><span class="z-punctuation z-section z-function z-elixir">(</span>rows <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> c <span class="z-keyword z-operator z-elixir">in</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-keyword z-operator z-range z-elixir">..</span><span class="z-punctuation z-section z-function z-elixir">(</span>cols <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">    cell <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>r<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> grid <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>at<span class="z-punctuation z-section z-function z-elixir">(</span>r<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>at<span class="z-punctuation z-section z-function z-elixir">(</span>c<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">cond</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      rows <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-logical z-elixir">not</span> in_bounds?<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>start<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">or</span> <span class="z-keyword z-operator z-logical z-elixir">not</span> in_bounds?<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>goal<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      cell<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>start<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span> <span class="z-keyword z-operator z-logical z-elixir">or</span> cell<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>goal<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      start <span class="z-keyword z-operator z-comparison z-elixir">==</span> goal <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        q <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>start<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        vis <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>start<span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        dirs <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">        brute_loop<span class="z-punctuation z-section z-function z-elixir">(</span>q<span class="z-punctuation z-separator z-object z-elixir">,</span> vis<span class="z-punctuation z-separator z-object z-elixir">,</span> dirs<span class="z-punctuation z-separator z-object z-elixir">,</span> in_bounds?<span class="z-punctuation z-separator z-object z-elixir">,</span> cell<span class="z-punctuation z-separator z-object z-elixir">,</span> goal<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">brute_loop</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>q<span class="z-punctuation z-separator z-object z-elixir">,</span> vis<span class="z-punctuation z-separator z-object z-elixir">,</span> dirs<span class="z-punctuation z-separator z-object z-elixir">,</span> in_bounds?<span class="z-punctuation z-separator z-object z-elixir">,</span> cell<span class="z-punctuation z-separator z-object z-elixir">,</span> goal<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">case</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>out<span class="z-punctuation z-section z-function z-elixir">(</span>q<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>value</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>pos<span class="z-punctuation z-separator z-sequence z-elixir">,</span> d<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> q2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-control z-elixir">if</span> pos <span class="z-keyword z-operator z-comparison z-elixir">==</span> goal <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">          d
</span><span class="z-source z-elixir">        <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">          <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>q3<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vis3<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">            <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>reduce<span class="z-punctuation z-section z-function z-elixir">(</span>dirs<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>q2<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vis<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>dr<span class="z-punctuation z-separator z-sequence z-elixir">,</span> dc<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">              <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>r<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> pos
</span><span class="z-source z-elixir">              nxt <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>r <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> dr<span class="z-punctuation z-separator z-sequence z-elixir">,</span> c <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> dc<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">              <span class="z-keyword z-control z-elixir">cond</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">                <span class="z-keyword z-operator z-logical z-elixir">not</span> in_bounds?<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>nxt<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">                <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>member?<span class="z-punctuation z-section z-function z-elixir">(</span>vv<span class="z-punctuation z-separator z-object z-elixir">,</span> nxt<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">                cell<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>nxt<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>qq<span class="z-punctuation z-separator z-sequence z-elixir">,</span> vv<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">                <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>queue</span><span class="z-punctuation z-separator z-method z-elixir">.</span>in<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>nxt<span class="z-punctuation z-separator z-sequence z-elixir">,</span> d <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> qq<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-entity z-name z-class z-elixir">MapSet</span><span class="z-punctuation z-separator z-method z-elixir">.</span>put<span class="z-punctuation z-section z-function z-elixir">(</span>vv<span class="z-punctuation z-separator z-sequence z-elixir">,</span> nxt<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">              <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">            <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">          brute_loop<span class="z-punctuation z-section z-function z-elixir">(</span>q3<span class="z-punctuation z-separator z-object z-elixir">,</span> vis3<span class="z-punctuation z-separator z-object z-elixir">,</span> dirs<span class="z-punctuation z-separator z-object z-elixir">,</span> in_bounds?<span class="z-punctuation z-separator z-object z-elixir">,</span> cell<span class="z-punctuation z-separator z-object z-elixir">,</span> goal<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>empty</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> _<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<h4 id="binary-search-variants">Binary search variants<a class="zola-anchor" href="#binary-search-variants" aria-label="Anchor link for: binary-search-variants" style="visibility: hidden;"></a>
</h4>
<p>link: <a href="raw-dogged-bin.exs">code</a></p>
<p>To run:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> elixir raw-dogged-bin.exs</span>
</span></code></pre>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">BinSearch</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@moduledoc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Binary search utilities over sorted lists and monotone predicates.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Provided functions:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * `lower_bound/2`: first index `i` such that `a[i] &gt;= x`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * `upper_bound/2`: first index `i` such that `a[i] &gt; x`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * `first_true/3`: first integer `i` in `[lo, hi)` where a monotone predicate becomes `true`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * `last_true/3`: last integer `i` in `[lo, hi)` where a monotone predicate is `true`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Conventions
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Indices are 0-based.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Ranges are half-open: `[lo, hi)`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * For bounds functions, if no element satisfies the condition, the returned index is `length(a)`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Requirements
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * `lower_bound/2` and `upper_bound/2` require `a` to be sorted ascending according to Erlang/Elixir term order.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * `first_true/3` and `last_true/3` require `pred` to be **monotone** on `[lo, hi)`:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">    there exists some threshold `t` such that `pred(i)` is false for `i &lt; t` and true for `i &gt;= t`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;0-based index into a list.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> index :: non_neg_integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;A half-open integer range `[lo, hi)`.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> lo :: integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> hi :: integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns the first index `i` in `0..length(a)` where `Enum.at(a, i) &gt;= x`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  If all elements are `&lt; x`, returns `length(a)`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.lower_bound([1, 2, 2, 4], 2)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      1
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.lower_bound([1, 2, 2, 4], 3)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      3
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.lower_bound([], 10)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      0
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">lower_bound</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> lb<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> length<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> lb<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">lb</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>_a<span class="z-punctuation z-separator z-object z-elixir">,</span> _x<span class="z-punctuation z-separator z-object z-elixir">,</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> lo <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> hi<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> lo
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">lb</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    mid <span class="z-keyword z-operator z-assignment z-elixir">=</span> lo <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> div<span class="z-punctuation z-section z-function z-elixir">(</span>hi <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">if</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>at<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> mid<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> lb<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> mid<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> lb<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> mid <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns the first index `i` in `0..length(a)` where `Enum.at(a, i) &gt; x`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  If all elements are `&lt;= x`, returns `length(a)`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.upper_bound([1, 2, 2, 4], 2)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      3
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.upper_bound([1, 2, 2, 4], 4)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      4
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.upper_bound([], 10)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      0
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">upper_bound</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> ub<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> length<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> ub<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span>term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">ub</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>_a<span class="z-punctuation z-separator z-object z-elixir">,</span> _x<span class="z-punctuation z-separator z-object z-elixir">,</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> lo <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> hi<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> lo
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">ub</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    mid <span class="z-keyword z-operator z-assignment z-elixir">=</span> lo <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> div<span class="z-punctuation z-section z-function z-elixir">(</span>hi <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">if</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>at<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> mid<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">&gt;</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> ub<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> mid<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> ub<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> mid <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Given integers `lo` and `hi`, returns the smallest integer `i` in `[lo, hi)`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  such that `pred.(i)` is `true`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  If `pred` is `false` for all `i` in `[lo, hi)`, returns `hi`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Requirements
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  `pred` must be monotone on `[lo, hi)` (false...false, then true...true).
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.first_true(0, 10, fn i -&gt; i &gt;= 7 end)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      7
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.first_true(0, 5, fn _ -&gt; false end)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      5
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> first_true<span class="z-punctuation z-section z-function z-elixir">(</span>lo<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-function z-elixir">(</span>integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> as_boolean<span class="z-punctuation z-section z-function z-elixir">(</span>term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">first_true</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lo<span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-separator z-object z-elixir">,</span> pred<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>lo<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>hi<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_function</span><span class="z-punctuation z-section z-function z-elixir">(</span>pred<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">if</span> lo <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> hi <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      lo
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">      mid <span class="z-keyword z-operator z-assignment z-elixir">=</span> lo <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> div<span class="z-punctuation z-section z-function z-elixir">(</span>hi <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> lo<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">if</span> pred<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>mid<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> first_true<span class="z-punctuation z-section z-function z-elixir">(</span>lo<span class="z-punctuation z-separator z-object z-elixir">,</span> mid<span class="z-punctuation z-separator z-object z-elixir">,</span> pred<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> first_true<span class="z-punctuation z-section z-function z-elixir">(</span>mid <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-separator z-object z-elixir">,</span> pred<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns the greatest integer `i` in `[lo, hi)` such that `pred.(i)` is `true`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  If `pred` is `false` for all `i` in `[lo, hi)`, returns `lo - 1`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  This is implemented via `first_true/3` by searching for the first index where `pred` becomes false.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Requirements
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  `pred` must be monotone on `[lo, hi)`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.last_true(0, 10, fn i -&gt; i &lt; 7 end)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      6
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; BinSearch.last_true(0, 10, fn _ -&gt; false end)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      -1
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> last_true<span class="z-punctuation z-section z-function z-elixir">(</span>lo<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-punctuation z-section z-function z-elixir">(</span>integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arrow z-elixir">-&gt;</span> as_boolean<span class="z-punctuation z-section z-function z-elixir">(</span>term<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">last_true</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>lo<span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-separator z-object z-elixir">,</span> pred<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-elixir">when</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>lo<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_integer</span><span class="z-punctuation z-section z-function z-elixir">(</span>hi<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-logical z-elixir">and</span> <span class="z-keyword z-guard z-elixir">is_function</span><span class="z-punctuation z-section z-function z-elixir">(</span>pred<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    i <span class="z-keyword z-operator z-assignment z-elixir">=</span> first_true<span class="z-punctuation z-section z-function z-elixir">(</span>lo<span class="z-punctuation z-separator z-object z-elixir">,</span> hi<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> j <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-keyword z-operator z-logical z-elixir">not</span> pred<span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-punctuation z-section z-function z-elixir">(</span>j<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    i <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> <span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span>start<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">BinSearchTest</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">use</span> <span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-entity z-name z-class z-elixir">Case</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">async<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>lower_bound/2<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>empty list<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>basic positions<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      a <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">3</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">3</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">4</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>works with arbitrary terms (term ordering)<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      a <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>a</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>c</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>b</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>bb</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">3</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>agrees with brute force<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      cases <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>each<span class="z-punctuation z-section z-function z-elixir">(</span>cases<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>a<span class="z-punctuation z-separator z-sequence z-elixir">,</span> x<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> brute_lower_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>upper_bound/2<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>empty list<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>basic positions<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      a <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">3</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">3</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">4</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">4</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>agrees with brute force<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      cases <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-punctuation z-section z-array z-elixir">[</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">        <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-punctuation z-section z-array z-elixir">[</span><span class="z-constant z-numeric z-elixir">1</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4</span><span class="z-punctuation z-section z-array z-elixir">]</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-array z-elixir">]</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>each<span class="z-punctuation z-section z-function z-elixir">(</span>cases<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>a<span class="z-punctuation z-separator z-sequence z-elixir">,</span> x<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span>
</span><span class="z-source z-elixir">        assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> brute_upper_bound<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>first_true/3<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>returns threshold when predicate flips false-&gt;true<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>first_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> i <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> i <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> <span class="z-constant z-numeric z-elixir">7</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">7</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>first_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">6</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> i <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> i <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> <span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>all false returns hi<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>first_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> _ <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-constant z-language z-elixir">false</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">5</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>all true returns lo<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>first_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> _ <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>lo &gt;= hi returns lo (empty range)<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>first_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> _ <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">3</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>first_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> _ <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">5</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>last_true/3<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>returns last index satisfying monotone predicate<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>last_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> i <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> i <span class="z-keyword z-operator z-comparison z-elixir">&lt;</span> <span class="z-constant z-numeric z-elixir">7</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">6</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>last_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> i <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> i <span class="z-keyword z-operator z-comparison z-elixir">&lt;=</span> <span class="z-constant z-numeric z-elixir">0</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>all false returns lo-1<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>last_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> _ <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-constant z-language z-elixir">false</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>last_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> _ <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-constant z-language z-elixir">false</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">4</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>all true returns hi-1<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>last_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">10</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> _ <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">9</span>
</span><span class="z-source z-elixir">      assert <span class="z-entity z-name z-class z-elixir">BinSearch</span><span class="z-punctuation z-separator z-method z-elixir">.</span>last_true<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-keyword z-operator z-arithmetic z-elixir">-</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> _ <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-constant z-language z-elixir">true</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">brute_lower_bound</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    a
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>with_index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>find_value<span class="z-punctuation z-section z-function z-elixir">(</span>length<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>v<span class="z-punctuation z-separator z-sequence z-elixir">,</span> i<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-keyword z-control z-elixir">if</span> v <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> i<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">nil</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">brute_upper_bound</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>a<span class="z-punctuation z-separator z-object z-elixir">,</span> x<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    a
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>with_index<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> <span class="z-entity z-name z-class z-elixir">Enum</span><span class="z-punctuation z-separator z-method z-elixir">.</span>find_value<span class="z-punctuation z-section z-function z-elixir">(</span>length<span class="z-punctuation z-section z-function z-elixir">(</span>a<span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-keyword z-control z-elixir">fn</span> <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>v<span class="z-punctuation z-separator z-sequence z-elixir">,</span> i<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-other z-elixir">-&gt;</span> <span class="z-keyword z-control z-elixir">if</span> v <span class="z-keyword z-operator z-comparison z-elixir">&gt;</span> x<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> i<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">else<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">nil</span> <span class="z-keyword z-control z-elixir">end</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>
<h4 id="rate-limiter">Rate limiter<a class="zola-anchor" href="#rate-limiter" aria-label="Anchor link for: rate-limiter" style="visibility: hidden;"></a>
</h4>
<p>link: <a href="raw-dogged-rate.exs">code</a></p>
<p>To run:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> elixir raw-dogged-rate.exs</span>
</span></code></pre>
<pre data-lang="elixir" class="language-elixir z-code"><code class="language-elixir" data-lang="elixir"><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@moduledoc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  In-memory token bucket rate limiter.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  The bucket holds up to `cap` tokens. Each `allow/1` attempt:
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * refills tokens based on elapsed time since `last_ms` using `refill_per_sec`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * caps tokens at `cap`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * consumes **1.0** token if available and returns `{true, updated_bucket}`
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * otherwise returns `{false, updated_bucket}` (with refilled/capped tokens)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Uses `System.monotonic_time(:millisecond)` to avoid issues with wall-clock jumps.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Notes
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Tokens are stored as floats (`0.0`, `1.0`, etc.). This allows fractional refill.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Initial tokens are full: `tokens == cap`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">alias</span> <span class="z-variable z-language z-elixir">__MODULE__</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">as<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;Token bucket state.&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> t :: %<span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> float<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> float<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">refill_per_sec<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> float<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">        <span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-string">@typedoc &quot;Capacity (tokens) or refill rate (tokens/sec).&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>type</span> rate :: number<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">defstruct</span> <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0.0</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">            <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0.0</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">            <span class="z-constant z-other z-keywords z-elixir">refill_per_sec<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0.0</span><span class="z-punctuation z-separator z-object z-elixir">,</span>
</span><span class="z-source z-elixir">            <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">nil</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Creates a new bucket with a maximum capacity and refill rate (tokens per second).
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  The bucket starts full.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  ## Examples
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; b = TokenBucket.new(2, 0)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {a1, b} = TokenBucket.allow(b)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {a2, b} = TokenBucket.allow(b)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {a3, _b} = TokenBucket.allow(b)
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      iex&gt; {a1, a2, a3}
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">      {true, true, false}
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> new<span class="z-punctuation z-section z-function z-elixir">(</span>rate<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-object z-elixir">,</span> rate<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">new</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>capacity<span class="z-punctuation z-separator z-object z-elixir">,</span> refill_per_sec<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    now <span class="z-keyword z-operator z-assignment z-elixir">=</span> now_ms<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    %<span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">      <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> capacity <span class="z-keyword z-operator z-arithmetic z-elixir">*</span> <span class="z-constant z-numeric z-elixir">1.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">      <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> capacity <span class="z-keyword z-operator z-arithmetic z-elixir">*</span> <span class="z-constant z-numeric z-elixir">1.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">      <span class="z-constant z-other z-keywords z-elixir">refill_per_sec<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> refill_per_sec <span class="z-keyword z-operator z-arithmetic z-elixir">*</span> <span class="z-constant z-numeric z-elixir">1.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">      <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> now
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">    <span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-comment z-documentation z-heredoc">@doc &quot;&quot;&quot;
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Attempts to consume one token.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  Returns `{allowed?, updated_bucket}`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * If there is at least 1 token after refilling, it consumes 1 token and returns `true`.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  * Otherwise returns `false` without consuming a token.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  This function always updates `last_ms` to the current monotonic time.
</span></span><span class="z-source z-elixir"><span class="z-comment z-documentation z-heredoc">  &quot;&quot;&quot;</span>
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> allow<span class="z-punctuation z-section z-function z-elixir">(</span>t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>boolean<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> t<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">def</span> <span class="z-entity z-name z-function z-public z-elixir">allow</span><span class="z-punctuation z-definition z-parameters z-elixir">(</span>bucket<span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">    now <span class="z-keyword z-operator z-assignment z-elixir">=</span> now_ms<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    elapsed <span class="z-keyword z-operator z-assignment z-elixir">=</span> max<span class="z-punctuation z-section z-function z-elixir">(</span>now <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> bucket<span class="z-punctuation z-separator z-method z-elixir">.</span>last_ms<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span> <span class="z-keyword z-operator z-arithmetic z-elixir">/</span> <span class="z-constant z-numeric z-elixir">1000.0</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    tokens <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">      <span class="z-punctuation z-section z-function z-elixir">(</span>bucket<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> elapsed <span class="z-keyword z-operator z-arithmetic z-elixir">*</span> bucket<span class="z-punctuation z-separator z-method z-elixir">.</span>refill_per_sec<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      <span class="z-keyword z-operator z-pipe z-elixir">|&gt;</span> min<span class="z-punctuation z-section z-function z-elixir">(</span>bucket<span class="z-punctuation z-separator z-method z-elixir">.</span>cap<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">if</span> tokens <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> <span class="z-constant z-numeric z-elixir">1.0</span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-language z-elixir">true</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>bucket <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> tokens <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> <span class="z-constant z-numeric z-elixir">1.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> now<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">else</span>
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span><span class="z-constant z-language z-elixir">false</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span> %<span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>bucket <span class="z-keyword z-operator z-other z-elixir">|</span> <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> tokens<span class="z-punctuation z-separator z-sequence z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> now<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span><span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  <span class="z-variable z-other z-module z-elixir"><span class="z-keyword z-operator z-definition z-constant z-elixir">@</span>spec</span> now_ms<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span> :: integer<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-meta z-function z-elixir">  <span class="z-keyword z-control z-module z-elixir">defp</span> <span class="z-entity z-name z-function z-private z-elixir">now_ms</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">do:</span></span> <span class="z-entity z-name z-class z-elixir">System</span><span class="z-punctuation z-separator z-method z-elixir">.</span>monotonic_time<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>millisecond</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span>start<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir"><span class="z-meta z-module z-elixir"><span class="z-keyword z-control z-module z-elixir">defmodule</span> <span class="z-entity z-name z-class z-elixir">TokenBucketTest</span> <span class="z-keyword z-control z-module z-elixir">do</span></span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">use</span> <span class="z-entity z-name z-class z-elixir">ExUnit</span><span class="z-punctuation z-separator z-method z-elixir">.</span><span class="z-entity z-name z-class z-elixir">Case</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-other z-keywords z-elixir">async<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>new/2<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>starts full and stores rates as floats<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      b <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">5</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert b<span class="z-punctuation z-separator z-method z-elixir">.</span>cap <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">5.0</span>
</span><span class="z-source z-elixir">      assert b<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">5.0</span>
</span><span class="z-source z-elixir">      assert b<span class="z-punctuation z-separator z-method z-elixir">.</span>refill_per_sec <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">2.0</span>
</span><span class="z-source z-elixir">      assert is_integer<span class="z-punctuation z-section z-function z-elixir">(</span>b<span class="z-punctuation z-separator z-method z-elixir">.</span>last_ms<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">  describe <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>allow/1<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>consumes one token when available (no refill)<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      b0 <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>new<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-numeric z-elixir">3</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ok<span class="z-punctuation z-separator z-sequence z-elixir">,</span> b1<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>allow<span class="z-punctuation z-section z-function z-elixir">(</span>b0<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert ok <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">      assert b1<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">2.0</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ok<span class="z-punctuation z-separator z-sequence z-elixir">,</span> b2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>allow<span class="z-punctuation z-section z-function z-elixir">(</span>b1<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert ok <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">      assert b2<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">1.0</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ok<span class="z-punctuation z-separator z-sequence z-elixir">,</span> b3<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>allow<span class="z-punctuation z-section z-function z-elixir">(</span>b2<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert ok <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">      assert b3<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0.0</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ok<span class="z-punctuation z-separator z-sequence z-elixir">,</span> b4<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>allow<span class="z-punctuation z-section z-function z-elixir">(</span>b3<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert ok <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">false</span>
</span><span class="z-source z-elixir">      assert b4<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0.0</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>denies when &lt; 1 token (no refill)<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      now <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">System</span><span class="z-punctuation z-separator z-method z-elixir">.</span>monotonic_time<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>millisecond</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      b <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">        %<span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">10.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0.5</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">refill_per_sec<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> now
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">        <span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ok<span class="z-punctuation z-separator z-sequence z-elixir">,</span> b2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>allow<span class="z-punctuation z-section z-function z-elixir">(</span>b<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert ok <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">false</span>
</span><span class="z-source z-elixir">      assert b2<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-numeric z-elixir">0.5</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>refills based on elapsed time and then consumes<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      now <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">System</span><span class="z-punctuation z-separator z-method z-elixir">.</span>monotonic_time<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>millisecond</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      b <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">        %<span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">5.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">0.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">refill_per_sec<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">2.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> now <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> <span class="z-constant z-numeric z-elixir">1_500</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">        <span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ok<span class="z-punctuation z-separator z-sequence z-elixir">,</span> b2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>allow<span class="z-punctuation z-section z-function z-elixir">(</span>b<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert ok <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert_in_delta b2<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">2.0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0.05</span>
</span><span class="z-source z-elixir">      assert b2<span class="z-punctuation z-separator z-method z-elixir">.</span>last_ms <span class="z-keyword z-operator z-comparison z-elixir">&gt;=</span> b<span class="z-punctuation z-separator z-method z-elixir">.</span>last_ms
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>caps tokens at capacity before consuming<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      now <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">System</span><span class="z-punctuation z-separator z-method z-elixir">.</span>monotonic_time<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>millisecond</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      b <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">        %<span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">5.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">4.9</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">refill_per_sec<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">10.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> now <span class="z-keyword z-operator z-arithmetic z-elixir">-</span> <span class="z-constant z-numeric z-elixir">1_000</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">        <span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ok<span class="z-punctuation z-separator z-sequence z-elixir">,</span> b2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>allow<span class="z-punctuation z-section z-function z-elixir">(</span>b<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert ok <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      assert_in_delta b2<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">4.0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0.05</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">    test <span class="z-meta z-string z-elixir"><span class="z-string z-quoted z-double z-elixir"><span class="z-punctuation z-definition z-string z-begin z-elixir">&quot;</span>handles time going backwards by treating elapsed as 0<span class="z-punctuation z-definition z-string z-end z-elixir">&quot;</span></span></span> <span class="z-keyword z-control z-elixir">do</span>
</span><span class="z-source z-elixir">      now <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">System</span><span class="z-punctuation z-separator z-method z-elixir">.</span>monotonic_time<span class="z-punctuation z-section z-function z-elixir">(</span><span class="z-constant z-other z-symbol z-elixir"><span class="z-punctuation z-definition z-constant z-elixir">:</span>millisecond</span><span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      b <span class="z-keyword z-operator z-assignment z-elixir">=</span>
</span><span class="z-source z-elixir">        %<span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">cap<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">2.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">tokens<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">1.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">refill_per_sec<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> <span class="z-constant z-numeric z-elixir">100.0</span><span class="z-punctuation z-separator z-sequence z-elixir">,</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">          <span class="z-constant z-other z-keywords z-elixir">last_ms<span class="z-punctuation z-definition z-constant z-elixir">:</span></span> now <span class="z-keyword z-operator z-arithmetic z-elixir">+</span> <span class="z-constant z-numeric z-elixir">10_000</span>
</span></span><span class="z-source z-elixir"><span class="z-meta z-sequence z-tuple z-elixir">        <span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span>
</span><span class="z-source z-elixir">
</span><span class="z-source z-elixir">      <span class="z-meta z-sequence z-tuple z-elixir"><span class="z-punctuation z-section z-sequence z-begin z-elixir">{</span>ok<span class="z-punctuation z-separator z-sequence z-elixir">,</span> b2<span class="z-punctuation z-section z-sequence z-end z-elixir">}</span></span> <span class="z-keyword z-operator z-assignment z-elixir">=</span> <span class="z-entity z-name z-class z-elixir">TokenBucket</span><span class="z-punctuation z-separator z-method z-elixir">.</span>allow<span class="z-punctuation z-section z-function z-elixir">(</span>b<span class="z-punctuation z-section z-function z-elixir">)</span>
</span><span class="z-source z-elixir">      assert ok <span class="z-keyword z-operator z-comparison z-elixir">==</span> <span class="z-constant z-language z-elixir">true</span>
</span><span class="z-source z-elixir">      assert_in_delta b2<span class="z-punctuation z-separator z-method z-elixir">.</span>tokens<span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0.0</span><span class="z-punctuation z-separator z-object z-elixir">,</span> <span class="z-constant z-numeric z-elixir">0.001</span>
</span><span class="z-source z-elixir">    <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir">  <span class="z-keyword z-control z-elixir">end</span>
</span><span class="z-source z-elixir"><span class="z-keyword z-control z-elixir">end</span>
</span></code></pre>

      </article>

      
      

      
      
    </div>

    


<footer>
  <div class="left">
    <div class="copyright">
      ∅ 2026 n0um3n4
      
    </div>
  </div>

  <div class="right">
    
    
      
    
    
    <a id="rss-btn" href="https://idunnowhatiamdoing.engineering/posts/feed.xml">RSS</a>
    
    

    
  </div>
</footer>




<dialog id="rss-mask">
  <div>
    <a href="https:&#x2F;&#x2F;idunnowhatiamdoing.engineering&#x2F;posts&#x2F;feed.xml">https:&#x2F;&#x2F;idunnowhatiamdoing.engineering&#x2F;posts&#x2F;feed.xml</a>
    
    
    <button autofocus aria-label="copy" data-link="https:&#x2F;&#x2F;idunnowhatiamdoing.engineering&#x2F;posts&#x2F;feed.xml" data-copy-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" data-check-icon="&lt;svg xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 24 24&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z&quot; fill=&quot;currentColor&quot;&gt;&lt;&#x2F;path&gt;&lt;&#x2F;svg&gt;
" >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>

    </button>
  </div>
</dialog>



  </main>
</div>

  
<script src="/js/lightense.min.js"></script>


  <script src="https://idunnowhatiamdoing.engineering/js/main.js"></script>
</body>

</html>
