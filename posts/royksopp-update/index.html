<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  
  
    
  
  <meta name="description" content="Software engineering à la Mexicana">

  <title>röyksopp | Update</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://idunnowhatiamdoing.engineering/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://idunnowhatiamdoing.engineering/img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://idunnowhatiamdoing.engineering/img/apple-touch-icon.png">
  
  <style>
  @import url("https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap");

  :root {
    --bg-top: #ffffff;
    --bg-bottom: #ffffff;
    --ink: #141414;
    --muted: #6a6358;
    --link: #1d4f8c;
    --max: 88ch;
    --pad: clamp(1rem, 3vw, 2.5rem);
  }

  * {
    box-sizing: border-box;
  }

  html {
    font-size: 100%;
  }

  body {
    margin: 0;
    min-height: 100%;
    padding: var(--pad);
    background: linear-gradient(180deg, var(--bg-top), var(--bg-bottom));
    color: var(--ink);
    font-family: "Share Tech Mono", monospace;
    font-size: 16px;
    line-height: 1.5;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
  }

  main.txt {
    max-width: var(--max);
    margin: 0 auto;
  }

  pre {
    font-family: "Share Tech Mono", monospace;
  }
  pre.txt-block {
    margin: 0;
    white-space: pre;
    overflow-x: auto;
  }

  a {
    color: inherit;
    text-decoration: underline;
    text-decoration-style: dotted;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  a:visited {
    color: inherit;
  }

  a:where(:hover, :focus) {
    color: var(--link);
  }

  ::selection {
    background: rgba(29, 79, 140, 0.18);
  }
  p {
    margin: 0;
    line-height: 16pt;
  }
  ul,
  ol {
    margin: 0;
    line-height: 10pt;
  }
  li {
    line-height: 16pt;
  }
  blockquote {
    margin: 0 16pt;
    line-height: 16pt;
  }
  img {
    max-width: 64ch;
  }
  @media (prefers-reduced-motion: no-preference) {
    main.txt {
      animation: fade-in 600ms ease-out both;
    }

    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }

  @media (max-width: 700px) {
    body {
      font-size: 15px;
      padding: 1rem;
    }
  }
</style>

  

<link id="hl" rel="stylesheet" type="text/css" href="/hl-light.css" />



  
</head>

<body class="post">
  
  
<main class="txt">
  <pre class="txt-block">

<a id="back-link" href="/">← back</a>

<b>röyksopp | Update</b>
<span id="publish">Jan 17, 2026</span>

<p>It started as an OTP-flavored actor runtime with a toy TCP mesh, and now it
has a minimal blockchain node layered on top.</p>
<p><strong>TL;DR</strong></p>
<ul>
<li>Added a minimal blockchain pipeline with persistence, mempool rules, and
round-robin consensus.</li>
<li>Introduced compact block propagation and batched sync.</li>
<li>Added CLI tools and scripts to spin up a local cluster and play with it.</li>
<li>Expanded docs, tests, and fuzzing so the system is easier to reason about.</li>
</ul>
<p><strong>What changed</strong></p>
<p><strong>Persistence and recovery</strong></p>
<ul>
<li><strong>BlockStore</strong> is still append-only, but the <strong>StateStore</strong> now uses
snapshot + WAL (write-ahead log).</li>
<li>On startup, state can <strong>recover by replaying the WAL</strong> and verifying
against the block store tip.</li>
<li>This gives a simple durability story without a full DB.</li>
</ul>
<p><strong>Mempool rules</strong></p>
<ul>
<li>Mempool now validates txs:
<ul>
<li><strong>size limit</strong></li>
<li><strong>minimum fee</strong></li>
<li><strong>duplicate detection</strong></li>
</ul>
</li>
<li>Ordering is <strong>fee-first</strong> when assembling blocks.</li>
<li><code>Tx</code> now includes a <code>fee</code> field and stable <code>id</code> hash.</li>
</ul>
<p><strong>Consensus hardening</strong></p>
<ul>
<li>Consensus is still <strong>round-robin leader</strong>, but now includes <strong>view timeouts</strong>.</li>
<li>A node bumps its <strong>view</strong> when it times out and broadcasts a <code>ViewChange</code>.</li>
<li>Blocks include the <strong>view</strong> in the header.</li>
</ul>
<p><strong>Block propagation</strong></p>
<ul>
<li>Added <strong>compact block announcements</strong>:
<ul>
<li>Nodes announce headers + tx IDs.</li>
<li>Peers reconstruct if they already have the txs.</li>
<li>Otherwise they fetch the full block by height.</li>
</ul>
</li>
<li>Added <strong>batched block sync</strong> to reduce RPC chatter.</li>
</ul>
<p><strong>Tooling and scripts</strong></p>
<p><strong>CLI binaries</strong></p>
<ul>
<li><code>royksopp</code> - run a node from config.</li>
<li><code>royksopp_keys</code> - generate/read keypair and print pubkey hex.</li>
<li><code>royksopp_play</code> - interactive playground (local or attached).</li>
</ul>
<p><strong>Scripts</strong></p>
<ul>
<li><code>scripts/run_nodes.sh</code> - spin up N nodes and write configs/logs.</li>
<li><code>scripts/play.sh</code> - interactive client (in-process by default).</li>
<li><code>scripts/demo.sh</code> - full demo: start nodes + attach client.</li>
</ul>
<p><strong>Make targets</strong></p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> demo      <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> nodes + interactive client</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> play      <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> in-process playground</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> nodes     <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> run nodes only</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> test      <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> all tests</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> clippy    <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> lint</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></code></pre>
<p><strong>API usage</strong></p>
<p>In-process submission:</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> tx <span class="z-keyword z-operator z-assignment z-rust">=</span> Tx <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> key<span class="z-punctuation z-separator z-rust">:</span> <span class="z-string z-quoted z-double z-rust"><span class="z-storage z-type z-string z-rust">b</span><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>foo<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_vec</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> value<span class="z-punctuation z-separator z-rust">:</span> <span class="z-string z-quoted z-double z-rust"><span class="z-storage z-type z-string z-rust">b</span><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>bar<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_vec</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span> fee<span class="z-punctuation z-separator z-rust">:</span> <span class="z-constant z-numeric z-integer z-decimal z-rust">1</span> </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust">runtime<span class="z-punctuation z-accessor z-dot z-rust">.</span>chain<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">submit_tx</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>tx</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre>
<p>RPC submission:</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> req <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">ChainRequest<span class="z-punctuation z-accessor z-rust">::</span></span>SubmitTx <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span> tx </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> bytes <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">bincode<span class="z-punctuation z-accessor z-rust">::</span></span>serialize<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-keyword z-operator z-bitwise z-rust">&amp;</span>req</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span><span class="z-source z-rust"><span class="z-storage z-type z-rust">let</span> resp_bytes <span class="z-keyword z-operator z-assignment z-rust">=</span> net<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">request</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>peer_id<span class="z-punctuation z-separator z-rust">,</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>chain<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> bytes<span class="z-punctuation z-separator z-rust">,</span> <span class="z-meta z-path z-rust">Duration<span class="z-punctuation z-accessor z-rust">::</span></span>from_secs<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-numeric z-integer z-decimal z-rust">2</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-source z-rust">                    <span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
</span></code></pre>
<p><strong>Wire protocol (short version)</strong></p>
<ul>
<li>All frames are <strong>length-delimited</strong> and <strong>bincode-encoded</strong>.</li>
<li>Envelope: <code>version</code>, <code>chain_id</code>, <code>msg_type</code>, <code>request_id</code>, <code>payload</code>.</li>
<li><code>Hello</code> includes <strong>ed25519 signature</strong> over version/chain_id/id/listen/pubkey.</li>
<li>Chain RPCs:
<ul>
<li><code>GetTip</code>, <code>GetBlock</code>, <code>GetBlocks</code>, <code>SubmitTx</code></li>
</ul>
</li>
</ul>
<p><strong>Documentation refresh</strong></p>
<p><code>README.md</code> now includes:</p>
<ul>
<li>Architecture overview</li>
<li>Wire protocol details</li>
<li>Config schema and defaults</li>
<li>API examples</li>
<li>Scripts and CLI usage</li>
</ul>
<p><strong>Tradeoffs / limitations</strong></p>
<ul>
<li>No tx signatures or account model.</li>
<li>No fork choice beyond round-robin + view timeouts.</li>
<li>Mempool is in-memory only.</li>
<li>Transport is authenticated but <strong>not encrypted</strong>.</li>
</ul>
<p><strong>If you want to try it</strong></p>
<p>The easiest path:</p>
<pre data-lang="bash" class="language-bash z-code"><code class="language-bash" data-lang="bash"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">make</span></span><span class="z-meta z-function-call z-arguments z-shell"> demo</span>
</span></code></pre>
<p>Then use the interactive prompt:</p>
<pre class="z-code"><code><span class="z-text z-plain">key=value [fee]
</span><span class="z-text z-plain">tip
</span><span class="z-text z-plain">exit
</span></code></pre>
<p><strong>What I want to do next</strong></p>
<ul>
<li>Persistent mempool + eviction</li>
<li>Snapshot/restore tools</li>
<li>Peer scoring + backoff</li>
<li>Transport encryption + message signing</li>
</ul>

  </pre>
</main>

  
<script src="/js/lightense.min.js"></script>

  <script src="https://idunnowhatiamdoing.engineering/js/main.js"></script>
</body>

</html>
